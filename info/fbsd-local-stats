#!/usr/bin/env zsh

ccache_pattern="(cache directory|cleanups|cache size|cache hit rate)"

print -nP "%F{blue}poudriere ccache stats%f\n" 2>&1 
env CCACHE_DIR=/srv/obj/ccache-poudriere ccache -s | grep -E "$ccache_pattern"
print -nP "%F{blue}local ccache stats%f\n"
ccache -s 2>&1 | grep -E "$ccache_pattern"

print -nP "%F{blue}Boot Information%f\n"
sysctl kern.bootfile

print -nP "%F{blue}Sysctl tuning%f\n"
float cur_vnodes="$(sysctl -n vfs.numvnodes)"
float max_vnodes="$(sysctl -n kern.maxvnodes)"

printf "numnodes usage: %0.2f%%\n" $(( $cur_vnodes / $max_vnodes ))
